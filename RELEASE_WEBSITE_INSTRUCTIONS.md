# Workflow: Build Release Notes Website (/releases)

This workflow provides instructions for setting up a public `/releases` URL on a Next.js website to display the release notes generated by the backend scripts.

## 1. Create Release Utility

Create `app/lib/releases.ts` to handle reading markdown files from the `.releases` directory.

```typescript
import fs from 'fs';
import path from 'path';

const RELEASES_DIR = path.join(process.cwd(), '.releases');

export interface Release {
    slug: string;
    date: string;
    title: string;
    content: string;
}

export function getAllReleases(): Release[] {
    if (!fs.existsSync(RELEASES_DIR)) {
        return [];
    }

    const files = fs.readdirSync(RELEASES_DIR);
    const releases = files
        .filter((file) => /^\d{4}-\d{2}-\d{2}\.md$/.test(file))
        .map((file) => {
            const filePath = path.join(RELEASES_DIR, file);
            const content = fs.readFileSync(filePath, 'utf8');
            const slug = file.replace('.md', '');

            // Use first line of markdown as title (stripping the #)
            const firstLine = content.split('\n')[0];
            const title = firstLine.replace(/^#\s*/, '') || slug;

            return { slug, date: slug, title, content };
        })
        .sort((a, b) => (a.date < b.date ? 1 : -1));

    return releases;
}

export function getReleaseBySlug(slug: string): Release | null {
    const filePath = path.join(RELEASES_DIR, `${slug}.md`);
    if (!fs.existsSync(filePath)) return null;

    const content = fs.readFileSync(filePath, 'utf8');
    const firstLine = content.split('\n')[0];
    const title = firstLine.replace(/^#\s*/, '') || slug;

    return { slug, date: slug, title, content };
}
```

## 2. Create Asset Handler API

Create `app/api/release-assets/[date]/[filename]/route.ts` to securely serve screenshots stored in `.releases/[date]/screenshots/`.

```typescript
import { NextRequest, NextResponse } from 'next/server';
import fs from 'fs';
import path from 'path';

export async function GET(
    request: NextRequest,
    { params }: { params: Promise<{ date: string; filename: string }> }
) {
    try {
        const { date, filename } = await params;

        // Security check
        if (!date || !filename || date.includes('..') || filename.includes('..')) {
            return new NextResponse('Invalid path', { status: 400 });
        }

        const filePath = path.join(process.cwd(), '.releases', date, 'screenshots', filename);
        if (!fs.existsSync(filePath)) return new NextResponse('File not found', { status: 404 });

        const fileBuffer = fs.readFileSync(filePath);
        const ext = path.extname(filename).toLowerCase();
        let contentType = 'application/octet-stream';
        if (ext === '.png') contentType = 'image/png';
        if (ext === '.jpg' || ext === '.jpeg') contentType = 'image/jpeg';

        return new NextResponse(new Uint8Array(fileBuffer), {
            headers: {
                'Content-Type': contentType,
                'Cache-Control': 'public, max-age=31536000, immutable',
            },
        });
    } catch (error) {
        return new NextResponse('Internal Server Error', { status: 500 });
    }
}
```

## 3. Create Releases Index Page

Create `app/releases/page.tsx` to list all available releases.

```tsx
import Link from 'next/link';
import { getAllReleases } from '@/app/lib/releases';

export default function ReleasesPage() {
    const releases = getAllReleases();

    return (
        <div className="container mx-auto px-4 py-12 max-w-4xl">
            <h1 className="text-4xl font-bold mb-12 text-center text-slate-900">Release Notes</h1>
            <div className="space-y-6">
                {releases.map((release) => (
                    <Link key={release.slug} href={`/releases/${release.slug}`} className="block group">
                        <div className="bg-white border border-slate-200 rounded-2xl p-8 shadow-sm hover:shadow-md transition-all hover:border-blue-200">
                            <div className="flex justify-between items-center">
                                <div>
                                    <span className="text-sm font-semibold text-blue-600 bg-blue-50 px-3 py-1 rounded-full mb-2 inline-block">
                                        {release.date}
                                    </span>
                                    <h2 className="text-2xl font-bold text-slate-900 group-hover:text-blue-600 transition-colors">
                                        {release.title}
                                    </h2>
                                </div>
                                <span className="font-semibold text-slate-400 group-hover:text-blue-600">→</span>
                            </div>
                        </div>
                    </Link>
                ))}
            </div>
        </div>
    );
}
```

## 4. Create Release Detail Page

Create `app/releases/[slug]/page.tsx`. Use `marked` to render the markdown content and a regex to remap internal image paths to the asset API.

```tsx
import { getReleaseBySlug } from '@/app/lib/releases';
import { notFound } from 'next/navigation';
import { marked } from 'marked';
import Link from 'next/link';

export default async function ReleasePage({
    params,
}: {
    params: Promise<{ slug: string }>;
}) {
    const { slug } = await params;
    const release = getReleaseBySlug(slug);

    if (!release) notFound();

    // Map internal paths ./2026-01-28/screenshots/f.png to /api/release-assets/2026-01-28/f.png
    const imageRegex = /\.\/(\d{4}-\d{2}-\d{2})\/screenshots\/([^)]+)/g;
    const content = release.content.replace(imageRegex, '/api/release-assets/$1/$2');
    const htmlContent = marked(content);

    return (
        <div className="container mx-auto px-4 py-12 max-w-4xl">
            <Link href="/releases" className="text-blue-600 font-semibold mb-8 inline-block">← Back</Link>
            <article className="markdown max-w-none">
                <div dangerouslySetInnerHTML={{ __html: htmlContent }} />
            </article>
        </div>
    );
}
```

## 5. Add Styling (globals.css)

Add these styles to your global CSS to format the rendered markdown.

```css
.markdown h1 { @apply text-3xl font-bold mt-8 mb-4 text-slate-900; }
.markdown h2 { @apply text-2xl font-bold mt-8 mb-4 border-b pb-2 border-slate-200; }
.markdown p { @apply mb-4 leading-relaxed text-slate-700; }
.markdown ul { @apply list-disc list-inside mb-4 space-y-2 ml-4; }
.markdown img { @apply rounded-xl shadow-lg border border-slate-200 my-8 max-w-full h-auto; }
.markdown code { @apply bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono border border-slate-200; }
```

## Pre-requisites
Ensure `marked` is installed:
```bash
npm install marked
```
